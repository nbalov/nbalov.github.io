var canvas=document.querySelector("canvas");canvas.width=document.querySelector(".container").clientWidth-36;if(canvas.width>1200) canvas.width=1200;canvas.height=canvas.width;var XRANGE=3;var YRANGE=3;var divPrec=document.querySelector("#msetscale");function MandelbrotSet(a){this.canvas=a;this.cx=a.getContext("2d");this.height=a.height;this.width=a.width;this.step=1;this.maxIter=100;this.scale=1;this.x0=0;this.y0=0;var k,r,g,b;this.palette=[];for(k=0;k<this.maxIter;k++){r=205*Math.abs(Math.sin(3.14*k/this.maxIter));g=205*Math.abs(Math.sin(3.14*k/this.maxIter));b=255*Math.abs(Math.sin(3.14*(k+5)/this.maxIter));this.palette.push("rgb("+r.toString()+","+g.toString()+","+b.toString()+")")}}MandelbrotSet.prototype.iterate2=function(x,y,a,b,k,n){var c=x*x-y*y+a;y=2*x*y+b;x=c;if(x*x+y*y>4)return k;k+=1;if(k>=n)return k;return this.iterate2(x,y,a,b,k,n)};MandelbrotSet.prototype.iterate4=function(x,y,a,b,k,n){var c=x*x-y*y;y=2*x*y;x=c;c=x*x-y*y+a;y=2*x*y+b;x=c;if(x*x+y*y>4)return k;k+=1;if(k>=n)return k;return this.iterate4(x,y,a,b,k,n)};MandelbrotSet.prototype.draw=function(a,b,c){var i,j,k,x,y,col;if(this.scale*c<1e-12){return}this.x0+=XRANGE*this.scale*a/this.width;this.y0+=YRANGE*this.scale*b/this.height;this.scale*=c;for(i=0;i<this.width;i+=this.step){x=this.x0+XRANGE*this.scale*i/this.width;for(j=0;j<this.height;j+=this.step){y=this.y0+this.scale*YRANGE*j/this.height;k=this.iterate2(0,0,x,y,0,this.maxIter);if(k>0){col=k-1;this.cx.fillStyle=this.palette[col]}else{this.cx.fillStyle=this.palette[0]}this.cx.fillRect(i,j,this.step,this.step)}}if(mset.scale<1e-10){divPrec.setAttribute("style","text-align:center;color:red; border: 2px solid white;");divPrec.textContent="Resolution: "+mset.scale.toExponential(2)+" (precision loss)"}else{divPrec.setAttribute("style","text-align:center;color:rgb(5,5,55);font-size:120%;");divPrec.textContent="Resolution: "+mset.scale.toExponential(2)}};function drawDefault(){mset.scale=1;mset.x0=0;mset.y0=0;mset.draw(-(XRANGE-1)*canvas.width/XRANGE,-canvas.height/2,1)}var mset=new MandelbrotSet(canvas);drawDefault();var xdown=0;var xlength=0;var ydown=0;var ylength=0;var divRect=document.createElement("div");function mouseup(a){canvas.removeEventListener("mousemove",moved);divRect.setAttribute("style","");document.body.removeChild(divRect);if(xlength<8||ylength<8)return;var b=Math.min(ylength/canvas.height,xlength/canvas.width);if(b<1e-12)b=1e-12;mset.draw(xdown,ydown,b)}function moved(a){if(a.which!=1){mouseup();return}xlength=a.offsetX-xdown;ylength=a.offsetY-ydown;var b=canvas.getBoundingClientRect();var c=xdown+b.left+window.scrollX;var d=ydown+b.top+window.scrollY;divRect.setAttribute("style","color:white; border: 2px solid white;"+"position: absolute; "+"top: "+d.toString()+"px;"+"left: "+c.toString()+"px;"+"width:"+xlength.toString()+"px;"+"height:"+ylength.toString()+"px;")}canvas.addEventListener("mouseclick",function(a){if(a.which==3){a.preventDefault();a.stopPropagation();drawDefault();return}});canvas.addEventListener("contextmenu",function(a){a.preventDefault();a.stopPropagation()});canvas.addEventListener("mousedown",function(a){if(a.which==3){drawDefault();return}if(a.which!=1){return}a.preventDefault();xdown=a.offsetX;ydown=a.offsetY;divRect.setAttribute("style","");document.body.appendChild(divRect);canvas.addEventListener("mousemove",moved)});canvas.addEventListener("mouseup",function(a){mouseup()});divRect.addEventListener("mouseup",function(a){mouseup()});
